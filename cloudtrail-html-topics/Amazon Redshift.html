<!DOCTYPE html>
<html lang="en-US" xmlns="http://www.w3.org/1999/xhtml">
 <head>
  <meta content="text/html; charset=utf-8" http-equiv="Content-Type"/>
  <title>
   Database audit logging - Amazon Redshift
  </title>
  <meta content="width=device-width,initial-scale=1" name="viewport"/>
  <meta content="/assets" name="assets_root"/>
  <meta content="db-auditing" name="target_state"/>
  <meta content="db-auditing" name="default_state"/>
  <link href="/assets/images/favicon.ico" rel="icon" type="image/ico"/>
  <link href="/assets/images/favicon.ico" rel="shortcut icon" type="image/ico"/>
  <link href="https://docs.aws.amazon.com/redshift/latest/mgmt/db-auditing.html" rel="canonical"/>
  <meta content="Monitor the database for security and troubleshooting purposes, called database auditing, with Amazon Redshift logs of connections and activities." name="description"/>
  <meta content="IAD" name="deployment_region"/>
  <meta content="Amazon Redshift" name="product"/>
  <meta content="Management Guide" name="guide"/>
  <meta content="Launch an Amazon Redshift cluster or workgroup and manage the petabyte-scale data warehouse service in the cloud." name="abstract"/>
  <meta content="en_us" name="guide-locale"/>
  <meta content="toc-contents.json" name="tocs"/>
  <link href="https://docs.aws.amazon.com/redshift/latest/mgmt/db-auditing.html" rel="canonical"/>
  <link href="https://docs.aws.amazon.com/id_id/redshift/latest/mgmt/db-auditing.html" hreflang="id-id" rel="alternative"/>
  <link href="https://docs.aws.amazon.com/id_id/redshift/latest/mgmt/db-auditing.html" hreflang="id" rel="alternative"/>
  <link href="https://docs.aws.amazon.com/de_de/redshift/latest/mgmt/db-auditing.html" hreflang="de-de" rel="alternative"/>
  <link href="https://docs.aws.amazon.com/de_de/redshift/latest/mgmt/db-auditing.html" hreflang="de" rel="alternative"/>
  <link href="https://docs.aws.amazon.com/redshift/latest/mgmt/db-auditing.html" hreflang="en-us" rel="alternative"/>
  <link href="https://docs.aws.amazon.com/redshift/latest/mgmt/db-auditing.html" hreflang="en" rel="alternative"/>
  <link href="https://docs.aws.amazon.com/es_es/redshift/latest/mgmt/db-auditing.html" hreflang="es-es" rel="alternative"/>
  <link href="https://docs.aws.amazon.com/es_es/redshift/latest/mgmt/db-auditing.html" hreflang="es" rel="alternative"/>
  <link href="https://docs.aws.amazon.com/fr_fr/redshift/latest/mgmt/db-auditing.html" hreflang="fr-fr" rel="alternative"/>
  <link href="https://docs.aws.amazon.com/fr_fr/redshift/latest/mgmt/db-auditing.html" hreflang="fr" rel="alternative"/>
  <link href="https://docs.aws.amazon.com/it_it/redshift/latest/mgmt/db-auditing.html" hreflang="it-it" rel="alternative"/>
  <link href="https://docs.aws.amazon.com/it_it/redshift/latest/mgmt/db-auditing.html" hreflang="it" rel="alternative"/>
  <link href="https://docs.aws.amazon.com/ja_jp/redshift/latest/mgmt/db-auditing.html" hreflang="ja-jp" rel="alternative"/>
  <link href="https://docs.aws.amazon.com/ja_jp/redshift/latest/mgmt/db-auditing.html" hreflang="ja" rel="alternative"/>
  <link href="https://docs.aws.amazon.com/ko_kr/redshift/latest/mgmt/db-auditing.html" hreflang="ko-kr" rel="alternative"/>
  <link href="https://docs.aws.amazon.com/ko_kr/redshift/latest/mgmt/db-auditing.html" hreflang="ko" rel="alternative"/>
  <link href="https://docs.aws.amazon.com/pt_br/redshift/latest/mgmt/db-auditing.html" hreflang="pt-br" rel="alternative"/>
  <link href="https://docs.aws.amazon.com/pt_br/redshift/latest/mgmt/db-auditing.html" hreflang="pt" rel="alternative"/>
  <link href="https://docs.aws.amazon.com/zh_cn/redshift/latest/mgmt/db-auditing.html" hreflang="zh-cn" rel="alternative"/>
  <link href="https://docs.aws.amazon.com/zh_tw/redshift/latest/mgmt/db-auditing.html" hreflang="zh-tw" rel="alternative"/>
  <link href="https://docs.aws.amazon.com/redshift/latest/mgmt/db-auditing.html" hreflang="x-default" rel="alternative"/>
  <meta content="Redshift" name="feedback-item"/>
  <meta content="Amazon Redshift" name="this_doc_product"/>
  <meta content="Management Guide" name="this_doc_guide"/>
  <script defer="" src="/assets/r/vendor4.js?version=2021.12.02">
  </script>
  <script defer="" src="/assets/r/vendor3.js?version=2021.12.02">
  </script>
  <script defer="" src="/assets/r/vendor1.js?version=2021.12.02">
  </script>
  <script defer="" src="/assets/r/awsdocs-common.js?version=2021.12.02">
  </script>
  <script defer="" src="/assets/r/awsdocs-doc-page.js?version=2021.12.02">
  </script>
  <link href="/assets/r/vendor4.css?version=2021.12.02" rel="stylesheet"/>
  <link href="/assets/r/awsdocs-common.css?version=2021.12.02" rel="stylesheet"/>
  <link href="/assets/r/awsdocs-doc-page.css?version=2021.12.02" rel="stylesheet"/>
  <script async="" data-config="{'appEntity':'aws-documentation','region':'us-east-1','service':'redshift'}" id="awsc-panorama-bundle" src="https://prod.pa.cdn.uis.awsstatic.com/panorama-nav-init.js" type="text/javascript">
  </script>
  <meta id="panorama-serviceSubSection" value="Management Guide"/>
  <meta id="panorama-serviceConsolePage" value="Database audit logging"/>
 </head>
 <body class="awsdocs awsui">
  <div class="awsdocs-container">
   <awsdocs-header>
   </awsdocs-header>
   <awsui-app-layout class="awsui-util-no-gutters" header-selector="awsdocs-header" id="app-layout" navigation-change="$ctrl.onNavChange($event)" navigation-hide="false" navigation-open="$ctrl.navOpen" navigation-width="$ctrl.navWidth" ng-controller="ContentController as $ctrl" tools-change="$ctrl.onToolsChange($event)" tools-hide="$ctrl.hideTools" tools-open="$ctrl.toolsOpen" tools-width="$ctrl.toolsWidth">
    <div dom-region="navigation" id="guide-toc">
     <awsdocs-toc>
     </awsdocs-toc>
    </div>
    <div dom-region="content" id="main-column" tabindex="-1">
     <awsdocs-view class="awsdocs-view">
      <div id="awsdocs-content">
       <head>
        <title>
         Database audit logging - Amazon Redshift
        </title>
        <meta content="/pdfs/redshift/latest/mgmt/redshift-mgmt.pdf#db-auditing" name="pdf"/>
        <meta content="CMDochistory.rss" name="rss"/>
        <meta content="https://repost.aws/tags/TAByF7MpfSQUCX_lAeDTvODw" name="forums"/>
        <meta content="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=Redshift&amp;topic_url=https://docs.aws.amazon.com/en_us/redshift/latest/mgmt/db-auditing.html" name="feedback"/>
        <meta content="feedbackyes.html?topic_url=https://docs.aws.amazon.com/en_us/redshift/latest/mgmt/db-auditing.html" name="feedback-yes"/>
        <meta content="feedbackno.html?topic_url=https://docs.aws.amazon.com/en_us/redshift/latest/mgmt/db-auditing.html" name="feedback-no"/>
        <meta content="Amazon Redshift,AWS Redshift,Redshift,connecting,cluster,launch cluster,data warehouse,management,cluster management,JDBC,ODBC,connection,security" name="keywords"/>
        <script type="application/ld+json">
         {
    "@context" : "https://schema.org",
    "@type" : "BreadcrumbList",
    "itemListElement" : [
      {
        "@type" : "ListItem",
        "position" : 1,
        "name" : "AWS",
        "item" : "https://aws.amazon.com"
      },
      {
        "@type" : "ListItem",
        "position" : 2,
        "name" : "Amazon Redshift",
        "item" : "https://docs.aws.amazon.com/redshift/index.html"
      },
      {
        "@type" : "ListItem",
        "position" : 3,
        "name" : "Management Guide",
        "item" : "https://docs.aws.amazon.com/redshift/latest/mgmt"
      },
      {
        "@type" : "ListItem",
        "position" : 4,
        "name" : "Security in Amazon Redshift",
        "item" : "https://docs.aws.amazon.com/redshift/latest/mgmt/iam-redshift-user-mgmt.html"
      },
      {
        "@type" : "ListItem",
        "position" : 5,
        "name" : "Logging and monitoring in Amazon Redshift",
        "item" : "https://docs.aws.amazon.com/redshift/latest/mgmt/security-incident-response.html"
      },
      {
        "@type" : "ListItem",
        "position" : 6,
        "name" : "Database audit logging",
        "item" : "https://docs.aws.amazon.com/redshift/latest/mgmt/security-incident-response.html"
      }
    ]
}
        </script>
       </head>
       <body>
        <div id="main">
         <div style="display: none">
          <a href="/pdfs/redshift/latest/mgmt/redshift-mgmt.pdf#db-auditing" rel="noopener noreferrer" target="_blank" title="Open PDF">
          </a>
         </div>
         <div class="breadcrumb" id="breadcrumbs">
          <a href="https://aws.amazon.com">
           AWS
          </a>
          <a href="/index.html">
           Documentation
          </a>
          <a href="/redshift/index.html">
           Amazon Redshift
          </a>
          <a href="welcome.html">
           Management Guide
          </a>
         </div>
         <div id="page-toc-src">
          <a href="#db-auditing-logs">
           Amazon Redshift logs
          </a>
          <a href="#db-auditing-cloudwatch-provisioned">
           Audit logs and Amazon CloudWatch
          </a>
         </div>
         <div class="awsui-util-container" id="main-content">
          <div id="main-col-body">
           <awsdocs-language-banner data-service="$ctrl.pageService">
           </awsdocs-language-banner>
           <h1 class="topictitle" id="db-auditing">
            Database audit logging
           </h1>
           <div class="awsdocs-page-header-container">
            <awsdocs-page-header>
            </awsdocs-page-header>
            <awsdocs-filter-selector id="awsdocs-filter-selector">
            </awsdocs-filter-selector>
           </div>
           <p>
            Amazon Redshift logs information about connections and user activities in your database. These
        logs help you to monitor the database for security and troubleshooting purposes, a process
        called
            <em>
             database auditing
            </em>
            . The logs can be stored
        in:
           </p>
           <div class="itemizedlist">
            <ul class="itemizedlist">
             <li class="listitem">
              <p>
               <em>
                Amazon S3 buckets
               </em>
               - This provides access with data-security
                features for users who are responsible for monitoring activities in the
                database.
              </p>
             </li>
             <li class="listitem">
              <p>
               <em>
                Amazon CloudWatch
               </em>
               - You can view audit-logging data using the features
                built into CloudWatch, such as visualization features and setting actions.
              </p>
             </li>
            </ul>
           </div>
           <div class="awsdocs-note">
            <div class="awsdocs-note-title">
             <awsui-icon name="status-info" variant="link">
             </awsui-icon>
             <h6>
              Note
             </h6>
            </div>
            <div class="awsdocs-note-text">
             <p>
              <a href="https://docs.aws.amazon.com/redshift/latest/dg/SYS_CONNECTION_LOG.html">
               SYS_CONNECTION_LOG
              </a>
              collects
            connection log data for Amazon Redshift Serverless. Note that when you collect audit logging data
            for Amazon Redshift Serverless, it can't be sent to log files, only to CloudWatch.
             </p>
            </div>
           </div>
           <div class="highlights">
            <h6>
             Topics
            </h6>
            <ul>
             <li>
              <a href="#db-auditing-logs">
               Amazon Redshift logs
              </a>
             </li>
             <li>
              <a href="#db-auditing-cloudwatch-provisioned">
               Audit logs and Amazon CloudWatch
              </a>
             </li>
             <li>
              <a href="./db-auditing-console.html">
               Enabling audit logging
              </a>
             </li>
            </ul>
           </div>
           <h2 id="db-auditing-logs">
            Amazon Redshift logs
           </h2>
           <p>
            Amazon Redshift logs information in the following log files:
           </p>
           <div class="itemizedlist">
            <ul class="itemizedlist">
             <li class="listitem">
              <p>
               <em>
                Connection log
               </em>
               â Logs authentication attempts,
                    connections, and disconnections.
              </p>
             </li>
             <li class="listitem">
              <p>
               <em>
                User log
               </em>
               â Logs information about changes to
                    database user definitions.
              </p>
             </li>
             <li class="listitem">
              <p>
               <em>
                User activity log
               </em>
               â Logs each query before
                    it's run on the database.
              </p>
             </li>
            </ul>
           </div>
           <p>
            The connection and user logs are useful primarily for security purposes. You can use
            the connection log to monitor information about users connecting to the database and
            related connection information. This information might be their IP address, when they
            made the request, what type of authentication they used, and so on. You can use the user
            log to monitor changes to the definitions of database users.
           </p>
           <p>
            The user activity log is useful primarily for troubleshooting purposes. It tracks
            information about the types of queries that both the users and the system perform in the
            database.
           </p>
           <p>
            The connection log and user log both correspond to information that is stored in the
            system tables in your database. You can use the system tables to obtain the same
            information, but the log files provide a simpler mechanism for retrieval and review. The
            log files rely on Amazon S3 permissions rather than database permissions to perform queries
            against the tables. Additionally, by viewing the information in log files rather than
            querying the system tables, you reduce any impact of interacting with the
            database.
           </p>
           <div class="awsdocs-note">
            <div class="awsdocs-note-title">
             <awsui-icon name="status-info" variant="link">
             </awsui-icon>
             <h6>
              Note
             </h6>
            </div>
            <div class="awsdocs-note-text">
             <p>
              Log files are not as current as the system log tables which are
              <a href="https://docs.aws.amazon.com/redshift/latest/dg/r_STL_USERLOG.html">
               STL_USERLOG
              </a>
              and
              <a href="https://docs.aws.amazon.com/redshift/latest/dg/r_STL_CONNECTION_LOG.html">
               STL_CONNECTION_LOG
              </a>
              . Records
                that are older than, but not including, the latest record are copied to log
                files.
             </p>
            </div>
           </div>
           <div class="awsdocs-note">
            <div class="awsdocs-note-title">
             <awsui-icon name="status-info" variant="link">
             </awsui-icon>
             <h6>
              Note
             </h6>
            </div>
            <div class="awsdocs-note-text">
             <p>
              For Amazon Redshift Serverless,
              <a href="https://docs.aws.amazon.com/redshift/latest/dg/SYS_CONNECTION_LOG.html">
               SYS_CONNECTION_LOG
              </a>
              collects connection-log data. When you collect audit
                logging data for Amazon Redshift Serverless, it can't be sent to log files, only to
                CloudWatch.
             </p>
            </div>
           </div>
           <h3 id="db-auditing-connection-log">
            Connection log
           </h3>
           <p>
            Logs authentication attempts, and connections and disconnections. The following
                table describes the information in the connection log. For more information about
                these fields, see
            <a href="https://docs.aws.amazon.com/redshift/latest/dg/r_STL_CONNECTION_LOG.html">
             STL_CONNECTION_LOG
            </a>
            in
                the
            <em>
             Amazon Redshift Database Developer Guide
            </em>
            . For more information about the collected
                connection log data for Amazon Redshift Serverless, see
            <a href="https://docs.aws.amazon.com/redshift/latest/dg/SYS_CONNECTION_LOG.html">
             SYS_CONNECTION_LOG
            </a>
            .
           </p>
           <div class="table-container">
            <div class="table-contents">
             <table id="w235aac33c32b9c11c17b5">
              <thead>
               <tr>
                <th>
                 Column name
                </th>
                <th>
                 Description
                </th>
               </tr>
              </thead>
              <tr>
               <td tabindex="-1">
                event
               </td>
               <td tabindex="-1">
                Connection or authentication event.
               </td>
              </tr>
              <tr>
               <td tabindex="-1">
                recordtime
               </td>
               <td tabindex="-1">
                Time the event occurred.
               </td>
              </tr>
              <tr>
               <td tabindex="-1">
                remotehost
               </td>
               <td tabindex="-1">
                Name or IP address of remote host.
               </td>
              </tr>
              <tr>
               <td tabindex="-1">
                remoteport
               </td>
               <td tabindex="-1">
                Port number for remote host.
               </td>
              </tr>
              <tr>
               <td tabindex="-1">
                pid
               </td>
               <td tabindex="-1">
                Process ID associated with the statement.
               </td>
              </tr>
              <tr>
               <td tabindex="-1">
                dbname
               </td>
               <td tabindex="-1">
                Database name.
               </td>
              </tr>
              <tr>
               <td tabindex="-1">
                username
               </td>
               <td tabindex="-1">
                User name.
               </td>
              </tr>
              <tr>
               <td tabindex="-1">
                authmethod
               </td>
               <td tabindex="-1">
                Authentication method.
               </td>
              </tr>
              <tr>
               <td tabindex="-1">
                duration
               </td>
               <td tabindex="-1">
                Duration of connection in microseconds.
               </td>
              </tr>
              <tr>
               <td tabindex="-1">
                sslversion
               </td>
               <td tabindex="-1">
                Secure Sockets Layer (SSL) version.
               </td>
              </tr>
              <tr>
               <td tabindex="-1">
                sslcipher
               </td>
               <td tabindex="-1">
                SSL cipher.
               </td>
              </tr>
              <tr>
               <td tabindex="-1">
                mtu
               </td>
               <td tabindex="-1">
                Maximum transmission unit (MTU).
               </td>
              </tr>
              <tr>
               <td tabindex="-1">
                sslcompression
               </td>
               <td tabindex="-1">
                SSL compression type.
               </td>
              </tr>
              <tr>
               <td tabindex="-1">
                sslexpansion
               </td>
               <td tabindex="-1">
                SSL expansion type.
               </td>
              </tr>
              <tr>
               <td tabindex="-1">
                iamauthguid
               </td>
               <td tabindex="-1">
                The AWS Identity and Access Management (IAM) authentication ID for the
                                AWS CloudTrail request. This is the identifier for the
                <a href="https://docs.aws.amazon.com/redshift/latest/APIReference/API_GetClusterCredentials.html">
                 GetClusterCredentials
                </a>
                API call to create the
                                credentials being used for a given connection.
               </td>
              </tr>
              <tr>
               <td tabindex="-1">
                application_name
               </td>
               <td tabindex="-1">
                The initial or updated name of the application for
                                a session.
               </td>
              </tr>
              <tr>
               <td tabindex="-1">
                os_version
               </td>
               <td tabindex="-1">
                The version of the operating system that is on the
                                client machine that connects to your Amazon Redshift cluster.
               </td>
              </tr>
              <tr>
               <td tabindex="-1">
                driver_version
               </td>
               <td tabindex="-1">
                The version of ODBC or JDBC driver that connects
                                to your Amazon Redshift cluster from your third-party SQL client tools.
               </td>
              </tr>
              <tr>
               <td tabindex="-1">
                plugin_name
               </td>
               <td tabindex="-1">
                The name of the plugin used to connect to your
                                Amazon Redshift cluster.
               </td>
              </tr>
              <tr>
               <td tabindex="-1">
                protocol_version
               </td>
               <td tabindex="-1">
                The internal protocol version that the Amazon Redshift driver
                                uses when establishing its connection with the server.
               </td>
              </tr>
              <tr>
               <td tabindex="-1">
                sessionid
               </td>
               <td tabindex="-1">
                The globally unique identifier for the current
                                session.
               </td>
              </tr>
              <tr>
               <td tabindex="-1">
                compression
               </td>
               <td tabindex="-1">
                The compression algorithm in use for the
                                connection.
               </td>
              </tr>
             </table>
            </div>
           </div>
           <h3 id="db-auditing-user-log">
            User log
           </h3>
           <p>
            Records details for the following changes to a database user:
           </p>
           <div class="itemizedlist">
            <ul class="itemizedlist">
             <li class="listitem">
              <p>
               Create user
              </p>
             </li>
             <li class="listitem">
              <p>
               Drop user
              </p>
             </li>
             <li class="listitem">
              <p>
               Alter user (rename)
              </p>
             </li>
             <li class="listitem">
              <p>
               Alter user (alter properties)
              </p>
             </li>
            </ul>
           </div>
           <div class="table-container">
            <div class="table-contents">
             <table id="w235aac33c32b9c11c19b7">
              <thead>
               <tr>
                <th>
                 Column name
                </th>
                <th>
                 Description
                </th>
               </tr>
              </thead>
              <tr>
               <td tabindex="-1">
                userid
               </td>
               <td tabindex="-1">
                ID of user affected by the change.
               </td>
              </tr>
              <tr>
               <td tabindex="-1">
                username
               </td>
               <td tabindex="-1">
                User name of the user affected by the
                                change.
               </td>
              </tr>
              <tr>
               <td tabindex="-1">
                oldusername
               </td>
               <td tabindex="-1">
                For a rename action, the original user name. For
                                any other action, this field is empty.
               </td>
              </tr>
              <tr>
               <td tabindex="-1">
                action
               </td>
               <td tabindex="-1">
                Action that occurred. Valid values:
                <div class="itemizedlist">
                 <ul class="itemizedlist">
                  <li class="listitem">
                   <p>
                    Alter
                   </p>
                  </li>
                  <li class="listitem">
                   <p>
                    Create
                   </p>
                  </li>
                  <li class="listitem">
                   <p>
                    Drop
                   </p>
                  </li>
                  <li class="listitem">
                   <p>
                    Rename
                   </p>
                  </li>
                 </ul>
                </div>
               </td>
              </tr>
              <tr>
               <td tabindex="-1">
                usecreatedb
               </td>
               <td tabindex="-1">
                If true (1), indicates that the user has create
                                database permissions.
               </td>
              </tr>
              <tr>
               <td tabindex="-1">
                usesuper
               </td>
               <td tabindex="-1">
                If true (1), indicates that the user is a
                                superuser.
               </td>
              </tr>
              <tr>
               <td tabindex="-1">
                usecatupd
               </td>
               <td tabindex="-1">
                If true (1), indicates that the user can update
                                system catalogs.
               </td>
              </tr>
              <tr>
               <td tabindex="-1">
                valuntil
               </td>
               <td tabindex="-1">
                Password expiration date.
               </td>
              </tr>
              <tr>
               <td tabindex="-1">
                pid
               </td>
               <td tabindex="-1">
                Process ID.
               </td>
              </tr>
              <tr>
               <td tabindex="-1">
                xid
               </td>
               <td tabindex="-1">
                Transaction ID.
               </td>
              </tr>
              <tr>
               <td tabindex="-1">
                recordtime
               </td>
               <td tabindex="-1">
                Time in UTC that the query started.
               </td>
              </tr>
             </table>
            </div>
           </div>
           <p>
            Query the
            <a href="https://docs.aws.amazon.com/redshift/latest/dg/SYS_USERLOG.html">
             SYS_USERLOG
            </a>
            system
                view to find additional information about changes to users. This view includes log
                data from Amazon Redshift Serverless.
           </p>
           <h3 id="db-auditing-user-activity-log">
            User activity log
           </h3>
           <p>
            Logs each query before it is run on the database.
           </p>
           <div class="table-container">
            <div class="table-contents">
             <table id="w235aac33c32b9c11c21b5">
              <thead>
               <tr>
                <th>
                 Column name
                </th>
                <th>
                 Description
                </th>
               </tr>
              </thead>
              <tr>
               <td tabindex="-1">
                recordtime
               </td>
               <td tabindex="-1">
                Time the event occurred.
               </td>
              </tr>
              <tr>
               <td tabindex="-1">
                db
               </td>
               <td tabindex="-1">
                Database name.
               </td>
              </tr>
              <tr>
               <td tabindex="-1">
                user
               </td>
               <td tabindex="-1">
                User name.
               </td>
              </tr>
              <tr>
               <td tabindex="-1">
                pid
               </td>
               <td tabindex="-1">
                Process ID associated with the statement.
               </td>
              </tr>
              <tr>
               <td tabindex="-1">
                userid
               </td>
               <td tabindex="-1">
                User ID.
               </td>
              </tr>
              <tr>
               <td tabindex="-1">
                xid
               </td>
               <td tabindex="-1">
                Transaction ID.
               </td>
              </tr>
              <tr>
               <td tabindex="-1">
                query
               </td>
               <td tabindex="-1">
                A prefix of LOG: followed by the text of the
                                query, including newlines.
               </td>
              </tr>
             </table>
            </div>
           </div>
           <h2 id="db-auditing-cloudwatch-provisioned">
            Audit logs and Amazon CloudWatch
           </h2>
           <p>
            Audit logging is not turned on by default in Amazon Redshift. When you turn on logging on
            your cluster, Amazon Redshift exports logs to Amazon CloudWatch, or creates and uploads logs to Amazon S3,
            that capture data from the time audit logging is enabled to the present time. Each
            logging update is a continuation of the previous logs.
           </p>
           <p>
            Audit logging to CloudWatch or to Amazon S3 is an optional process. Logging to system tables is
            not optional and happens automatically. For more information about logging to system
            tables, see
            <a href="https://docs.aws.amazon.com/redshift/latest/dg/cm_chap_system-tables.html">
             System Tables
                Reference
            </a>
            in the Amazon Redshift Database Developer Guide.
           </p>
           <p>
            The connection log, user log, and user activity log are enabled together by using the
            AWS Management Console, the Amazon Redshift API Reference, or the AWS Command Line Interface (AWS CLI). For the user activity
            log, you must also enable the
            <code class="code">
             enable_user_activity_logging
            </code>
            database
            parameter. If you enable only the audit logging feature, but not the associated
            parameter, the database audit logs log information for only the connection log and user
            log, but not for the user activity log. The
            <code class="code">
             enable_user_activity_logging
            </code>
            parameter is not enabled (
            <code class="code">
             false
            </code>
            ) by default. You can set it to
            <code class="code">
             true
            </code>
            to enable the user activity log. For more information, see
            <a href="./working-with-parameter-groups.html">
             Amazon Redshift parameter groups
            </a>
            .
           </p>
           <p>
            When you enable logging to CloudWatch, Amazon Redshift exports cluster connection, user, and
            user-activity log data to an Amazon CloudWatch Logs log group. The log data doesn't change, in terms
            of schema. CloudWatch is built for monitoring applications, and you can use it to perform
            real-time analysis or set it to take actions. You can also use Amazon CloudWatch Logs to store your
            log records in durable storage.
           </p>
           <p>
            Using CloudWatch to view logs is a recommended alternative to storing log files in Amazon S3. It
            doesn't require much configuration, and it may suit your monitoring requirements,
            especially if you use it already to monitor other services and applications.
           </p>
           <h3 id="db-auditing-cloudwatch-provisioned-log-group">
            Log groups and log
                    events in Amazon CloudWatch
           </h3>
           <p>
            After selecting which Amazon Redshift logs to export, you can monitor log events in
                Amazon CloudWatch Logs. A new log group is automatically created for Amazon Redshift Serverless, under the
                following prefix, in which
            <code class="code">
             log_type
            </code>
            represents the log type.
           </p>
           <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><!--DEBUG: cli ()--><code class="">/aws/redshift/cluster/&lt;cluster_name&gt;/&lt;log_type&gt;</code></pre>
           <p>
            For example, if you choose to export the connection log, log data is stored in the
                following log group.
           </p>
           <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><!--DEBUG: cli ()--><code class="">/aws/redshift/cluster/cluster1/connectionlog</code></pre>
           <p>
            Log events are exported to a log group using the log stream. To search for
                information within log events for your serverless endpoint, use the Amazon CloudWatch Logs console, the
                AWS CLI, or the Amazon CloudWatch Logs API. For information about searching and filtering log data,
                see
            <a href="https://docs.aws.amazon.com/AmazonCloudWatch/latest/logs/MonitoringLogData.html">
             Creating metrics from log
                    events using filters
            </a>
            .
           </p>
           <p>
            In CloudWatch, you can search your log data with a query syntax that provides for
                granularity and flexibility. For more information, see
            <a href="https://docs.aws.amazon.com/AmazonCloudWatch/latest/logs/CWL_QuerySyntax.html">
             CloudWatch Logs Insights query
                syntax
            </a>
            .
           </p>
           <h3 id="db-auditing-cloudwatch-provisioned-migration">
            Migrating to Amazon CloudWatch
                    audit logging
           </h3>
           <p>
            In any case where you are sending logs to Amazon S3 and you change the configuration,
                for example to send logs to CloudWatch, logs that remain in Amazon S3 are unaffected. You can
                still query the log data in the Amazon S3 buckets where it resides.
           </p>
           <h3 id="db-auditing-manage-log-files">
            Log files in Amazon S3
           </h3>
           <p>
            The number and size of Amazon Redshift log files in Amazon S3 depends heavily on the activity
                in your cluster. If you have an active cluster that is generating a large number of
                logs, Amazon Redshift might generate the log files more frequently. You might have a series
                of log files for the same type of activity, such as having multiple connection logs
                within the same hour.
           </p>
           <p>
            When Amazon Redshift uses Amazon S3 to store logs, you incur charges for the storage that you
                use in Amazon S3. Before you configure logging to Amazon S3, plan for how long you need to
                store the log files. As part of this, determine when the log files can either be
                deleted or archived, based on your auditing needs. The plan that you create depends
                heavily on the type of data that you store, such as data subject to compliance or
                regulatory requirements. For more information about Amazon S3 pricing, go to
            <a href="https://aws.amazon.com/s3/pricing/" rel="noopener noreferrer" target="_blank">
             <span>
              Amazon Simple Storage Service (S3) Pricing
             </span>
             <awsui-icon class="awsdocs-link-icon" name="external">
             </awsui-icon>
            </a>
            .
           </p>
           <h4 id="db-auditing-enable-logging-limitations">
            Limitations when you
                        enable logging to Amazon S3
           </h4>
           <p>
            Audit logging has the following constraints:
           </p>
           <div class="itemizedlist">
            <ul class="itemizedlist">
             <li class="listitem">
              <p>
               You can use only Amazon S3-managed keys (SSE-S3) encryption
                            (AES-256).
              </p>
             </li>
             <li class="listitem">
              <p>
               The Amazon S3 buckets must have the S3 Object Lock feature turned
                            off.
              </p>
             </li>
            </ul>
           </div>
           <h4 id="db-auditing-bucket-permissions">
            Bucket permissions for Amazon Redshift
                        audit logging
           </h4>
           <p>
            When you turn on logging to Amazon S3, Amazon Redshift collects logging information and
                    uploads it to log files stored in Amazon S3. You can use an existing bucket or a new
                    bucket. Amazon Redshift requires the following IAM permissions to the bucket:
           </p>
           <div class="itemizedlist">
            <ul class="itemizedlist">
             <li class="listitem">
              <p>
               <code class="code">
                s3:GetBucketAcl
               </code>
               The service requires read permissions to
                            the Amazon S3 bucket so it can identify the bucket owner.
              </p>
             </li>
             <li class="listitem">
              <p>
               <code class="code">
                s3:PutObject
               </code>
               The service requires put object permissions
                            to upload the logs. Also, the user or IAM role that turns on logging
                            must have
               <code class="code">
                s3:PutObject
               </code>
               permission to the Amazon S3 bucket. Each
                            time logs are uploaded, the service determines whether the current
                            bucket owner matches the bucket owner at the time logging was enabled.
                            If these owners don't match, you receive an error.
              </p>
             </li>
            </ul>
           </div>
           <p>
            If, when you enable audit logging, you select the option to create a new
                    bucket, correct permissions are applied to it. However, if you create your own
                    bucket in Amazon S3, or use an existing bucket, make sure to add a bucket policy that
                    includes the bucket name. Logs are delivered using service-principal
                    credentials. For most AWS Regions, you add the Redshift service-principal
                    name,
            <code class="replaceable">
             redshift.amazonaws.com
            </code>
            .
           </p>
           <p>
            The bucket policy uses the following format.
            <code class="replaceable">
             ServiceName
            </code>
            and
            <code class="replaceable">
             BucketName
            </code>
            are placeholders for your own values.
                    Also specify the associated actions and resources in the bucket policy.
           </p>
           <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><!--DEBUG: cli ()--><code class=""><span>{</span>
    "Version": "2012-10-17",
    "Statement": [
        <span>{</span>
            "Sid": "Put bucket policy needed for audit logging",
            "Effect": "Allow",
            "Principal": <span>{</span>
                "Service": "ServiceName"
            },
            "Action": [
                "s3:PutObject",
                "s3:GetBucketAcl"
            ],
            "Resource": [
                "arn:aws:s3:::BucketName",
                "arn:aws:s3:::BucketName/*"
            ]
        }
    ]
}</code></pre>
           <p>
            The following example is a bucket policy for the US East (N. Virginia) Region and a bucket
                    named
            <code class="code">
             AuditLogs
            </code>
            .
           </p>
           <pre class="programlisting"><div class="code-btn-container"><div class="btn-copy-code" title="Copy"><awsui-icon name="copy"></awsui-icon></div></div><!--DEBUG: cli ()--><code class=""><span>{</span>
    "Version": "2008-10-17",
    "Statement": [
        <span>{</span>
            "Sid": "Put bucket policy needed for audit logging",
            "Effect": "Allow",
            "Principal": <span>{</span>
                "Service": "redshift.amazonaws.com"
            },
            "Action": [
                "s3:PutObject",
                "s3:GetBucketAcl"
            ],
            "Resource": [
                "arn:aws:s3:::AuditLogs",
                "arn:aws:s3:::AuditLogs/*"
            ]
        }
    ]
}</code></pre>
           <p>
            Regions that aren't enabled by default, also known as "opt-in" Regions,
                    require a Region-specific service principal name. For these, the
                    service-principal name includes the region, in the format
            <code class="code">
             redshift.
             <code class="replaceable">
              region
             </code>
             .amazonaws.com
            </code>
            .
                    For example,
            <code class="replaceable">
             redshift.ap-east-1.amazonaws.com
            </code>
            for the
                    Asia Pacific (Hong Kong) Region. For a list of the Regions that aren't enabled by default, see
            <a href="https://docs.aws.amazon.com/general/latest/gr/rande-manage.html">
             Managing AWS Regions
            </a>
            in the
            <em>
             AWS General Reference
            </em>
            .
           </p>
           <div class="awsdocs-note">
            <div class="awsdocs-note-title">
             <awsui-icon name="status-info" variant="link">
             </awsui-icon>
             <h6>
              Note
             </h6>
            </div>
            <div class="awsdocs-note-text">
             <p>
              The Region-specific service-principal name corresponds to the Region where
                        the cluster is located.
             </p>
            </div>
           </div>
           <h5 id="db-auditing-bucket-permissions-confused-deputy">
            Best
                            practices for log files
           </h5>
           <p>
            When Redshift uploads log files to Amazon S3, large files can be uploaded in
                        parts. If a multipart upload isn't successful, it's possible for parts of a
                        file to remain in the Amazon S3 bucket. This can result in additional storage
                        costs, so it's important to understand what occurs when a multipart upload
                        fails. For a detailed explanation about multipart upload for audit logs, see
            <a href="https://docs.aws.amazon.com/AmazonS3/latest/userguide/mpuoverview.html">
             Uploading and copying objects
                            using multipart upload
            </a>
            and
            <a href="https://docs.aws.amazon.com/AmazonS3/latest/userguide/abort-mpu.html">
             Aborting a multipart
                        upload
            </a>
            .
           </p>
           <p>
            For more information about creating S3 buckets and adding bucket policies, see
            <a href="https://docs.aws.amazon.com/AmazonS3/latest/user-guide/CreatingaBucket.html">
             Creating a Bucket
            </a>
            and
            <a href="https://docs.aws.amazon.com/AmazonS3/latest/user-guide/EditingBucketPermissions.html">
             Editing Bucket
                        Permissions
            </a>
            in the
            <em>
             Amazon Simple Storage Service User Guide
            </em>
            .
           </p>
           <h4 id="db-auditing-bucket-structure">
            Bucket structure for Amazon Redshift
                        audit logging
           </h4>
           <p>
            By default, Amazon Redshift organizes the log files in the Amazon S3 bucket by using the
                    following bucket and object structure:
            <code>
            </code>
           </p>
           <p>
            <code>
             AWSLogs/
             <code class="replaceable">
              AccountID
             </code>
             /
             <code class="replaceable">
              ServiceName
             </code>
             /
             <code class="replaceable">
              Region
             </code>
             /
             <code class="replaceable">
              Year
             </code>
             /
             <code class="replaceable">
              Month
             </code>
             /
             <code class="replaceable">
              Day
             </code>
             /
             <code class="replaceable">
              AccountID_ServiceName_Region_ClusterName_LogType_Timestamp.gz
             </code>
            </code>
           </p>
           <p>
            An example is:
            <code>
             AWSLogs/123456789012/redshift/us-east-1/2013/10/29/123456789012_redshift_us-east-1_mycluster_userlog_2013-10-29T18:01.gz
            </code>
           </p>
           <p>
            If you provide an Amazon S3 key prefix, put the prefix at the start of the
                    key.
           </p>
           <p>
            For example, if you specify a prefix of myprefix:
            <code>
             myprefix/AWSLogs/123456789012/redshift/us-east-1/2013/10/29/123456789012_redshift_us-east-1_mycluster_userlog_2013-10-29T18:01.gz
            </code>
           </p>
           <p>
            The Amazon S3 key prefix can't exceed 512 characters. It can't contain
                    spaces ( ), double quotation marks (â), single quotation marks (â), a backslash
                    (\). There is also a number of special characters and control characters that
                    aren't allowed. The hexadecimal codes for these characters are as
                    follows:
           </p>
           <div class="itemizedlist">
            <ul class="itemizedlist">
             <li class="listitem">
              <p>
               x00 to x20
              </p>
             </li>
             <li class="listitem">
              <p>
               x22
              </p>
             </li>
             <li class="listitem">
              <p>
               x27
              </p>
             </li>
             <li class="listitem">
              <p>
               x5c
              </p>
             </li>
             <li class="listitem">
              <p>
               x7f or larger
              </p>
             </li>
            </ul>
           </div>
           <h3 id="db-auditing-failures">
            Audit logging in Amazon S3 considerations
           </h3>
           <p>
            Amazon Redshift audit logging can be interrupted for the following reasons:
           </p>
           <div class="itemizedlist">
            <ul class="itemizedlist">
             <li class="listitem">
              <p>
               Amazon Redshift does not have permission to upload logs to the Amazon S3 bucket.
                        Verify that the bucket is configured with the correct IAM policy. For more
                        information, see
               <a href="#db-auditing-bucket-permissions">
                Bucket permissions for Amazon Redshift
                        audit logging
               </a>
               .
              </p>
             </li>
             <li class="listitem">
              <p>
               The bucket owner changed. When Amazon Redshift uploads logs, it verifies that
                        the bucket owner is the same as when logging was enabled. If the bucket
                        owner has changed, Amazon Redshift cannot upload logs until you configure another
                        bucket to use for audit logging.
              </p>
             </li>
             <li class="listitem">
              <p>
               The bucket cannot be found. If the bucket is deleted in Amazon S3, Amazon Redshift
                        cannot upload logs. You either must recreate the bucket or configure
                        Amazon Redshift to upload logs to a different bucket.
              </p>
             </li>
            </ul>
           </div>
           <h3 id="rs-db-auditing-cloud-trail">
            API calls with AWS CloudTrail
           </h3>
           <p>
            Amazon Redshift is integrated with AWS CloudTrail, a service that provides a record of actions
                taken by a user, role, or an AWS service in Amazon Redshift. CloudTrail captures all API calls for
                Amazon Redshift as events. For more information about Amazon Redshift integration with AWS CloudTrail, see
            <a href="https://docs.aws.amazon.com/redshift/latest/mgmt/logging-with-cloudtrail.html">
             Logging with
                    CloudTrail
            </a>
            .
           </p>
           <p>
            You can use CloudTrail independently from or in addition to Amazon Redshift database audit logging.
           </p>
           <p>
            To learn more about CloudTrail, see the
            <a href="https://docs.aws.amazon.com/awscloudtrail/latest/userguide/">
             AWS CloudTrail User Guide
            </a>
            .
           </p>
           <awsdocs-copyright class="copyright-print">
           </awsdocs-copyright>
           <awsdocs-thumb-feedback right-edge="{{$ctrl.thumbFeedbackRightEdge}}">
           </awsdocs-thumb-feedback>
          </div>
          <noscript>
           <div>
            <div>
             <div>
              <div id="js_error_message">
               <p>
                <img alt="Warning" src="https://d1ge0kk1l5kms0.cloudfront.net/images/G/01/webservices/console/warning.png"/>
                <strong>
                 Javascript is disabled or is unavailable in your browser.
                </strong>
               </p>
               <p>
                To use the Amazon Web Services Documentation, Javascript must be enabled. Please refer to your browser's Help pages for instructions.
               </p>
              </div>
             </div>
            </div>
           </div>
          </noscript>
          <div class="awsui-util-font-size-0" id="main-col-footer">
           <div id="doc-conventions">
            <a href="/general/latest/gr/docconventions.html" target="_top">
             Document Conventions
            </a>
           </div>
           <div class="prev-next">
            <div accesskey="p" class="prev-link" href="./security-incident-response.html" id="previous">
             Logging and monitoring
            </div>
            <div accesskey="n" class="next-link" href="./db-auditing-console.html" id="next">
             Enabling audit logging
            </div>
           </div>
          </div>
          <awsdocs-page-utilities>
          </awsdocs-page-utilities>
         </div>
         <div id="quick-feedback-yes" style="display: none;">
          <div class="title">
           Did this page help you? - Yes
          </div>
          <div class="content">
           <p>
            Thanks for letting us know we're doing a good job!
           </p>
           <p>
            If you've got a moment, please tell us what we did right so we can do more of it.
           </p>
           <p>
            <awsui-button click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=Redshift&amp;topic_url=https://docs.aws.amazon.com/en_us/redshift/latest/mgmt/db-auditing.html" id="fblink" rel="noopener noreferrer" target="_blank" text="Feedback">
            </awsui-button>
           </p>
          </div>
         </div>
         <div id="quick-feedback-no" style="display: none;">
          <div class="title">
           Did this page help you? - No
          </div>
          <div class="content">
           <p>
            Thanks for letting us know this page needs work. We're sorry we let you down.
           </p>
           <p>
            If you've got a moment, please tell us how we can make the documentation better.
           </p>
           <p>
            <awsui-button click="linkClick($event)" href="https://docs.aws.amazon.com/forms/aws-doc-feedback?hidden_service_name=Redshift&amp;topic_url=https://docs.aws.amazon.com/en_us/redshift/latest/mgmt/db-auditing.html" id="fblink" rel="noopener noreferrer" target="_blank" text="Feedback">
            </awsui-button>
           </p>
          </div>
         </div>
        </div>
       </body>
      </div>
     </awsdocs-view>
     <div class="page-loading-indicator" id="page-loading-indicator">
      <awsui-spinner size="large">
      </awsui-spinner>
     </div>
    </div>
    <div dom-region="tools" id="tools-panel">
     <awsdocs-tools-panel id="awsdocs-tools-panel">
     </awsdocs-tools-panel>
    </div>
   </awsui-app-layout>
   <awsdocs-cookie-banner class="doc-cookie-banner">
   </awsdocs-cookie-banner>
  </div>
 </body>
</html>
